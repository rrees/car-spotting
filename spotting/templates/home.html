{% extends 'layout.html' %}

{% block title %}Home page{% endblock %}

{% block content %}

{% include 'macros.html' %}

{{ flash_messages('success') }}

<form id="spotting-form" class="form" method="POST" action="/forms/log/submission">
	<div class="form--control-group">
		<label forid="brand">Brand</label>
		<select id="brand" name="brand" v-model="brand">
			<option></option>
			{% for brand in brands %}
			<option value="{{brand}}">{{brand}}</option>
			{% endfor %}
		</select>
	</div>
	<div class="form--control-group">
		<label forid="brand-free">Brand (other)</label>
		<input id="brand-free" name="brand_free" type="text" v-model="brandFree">
		<div class="suggested-brands-list">
		</div>
	</div>
	<div class="form--control-group">
		<label forid="classic">Classic</label>
		<input id="classic" name="classic" type="checkbox">
	</div>
	<div class="form--control-group">
		<label forid="model">Model</label>
		<input id="model" name="model" type="text" v-model="model">
		<div class="suggested-models-list">
			<!-- <pre>[[$data]]</pre> -->
			<ul>
				<li v-for="model in models" v-on:click="setModel(model)">[[model]]</li>
			</ul>
		</div>
	</div>
	<div class="form--control-group">
		<button class="btn" type="submit">Record</button>
	</div>
</form>
{% endblock %}

{% block scripts %}
<script src="https://vuejs.org/js/vue.min.js"></script>
<script>

const app = new Vue({
	delimiters: ["[[", "]]"],
	el: "#spotting-form",
	data: {
		brand: undefined,
		model: undefined,
		models: undefined,
		brandFree: undefined,
		suggestedBrands: undefined
	},
	methods: {
		setModel: function(modelName) {
			const vm = this;
			vm.model = modelName;
			vm.models = [];
		}
	},
	computed: {
		modelChoicesPresent: function() {
			return this.models.length > 0;
		}
	},
	watch: {
		brand: function() {
			const vm = this;
			fetch('/api/brand/' + vm.brand + '/models/suggestions')
				.then((response) => {
					response.json().then((json) => {
						//console.log(json);
						vm.models = json.models;
					})
				});
		},
		brandFree: function() {
			const vm = this;
			fetch('/api/brand/' + vm.brandFree + '/models/suggestions')
				.then((response) => {
					response.json().then((json) => {
						//console.log(json);
						vm.models = json.models;
					})
				});
		}
	}
});
</script>
{% endblock %}
